# ChromeOS key mappings
#
# The keymaps in this file normalize the hardware into a complete and usable
# keyboard for Linux. Complete means all the necessary keys exist, and usable
# means the behavior of each key aligns with the location and what the key looks
# like.
#
# These keymaps were inspired from https://github.com/WeirdTreeThing/cros-keyboard-map/
# and https://github.com/rvaiya/keyd/blob/master/examples/chromebook-linux.conf

## Identifiers
# This config lists many known hardware identifiers for keyboards in ChromeOS
# devices.
#
# The HP Elite Dragonfly (Redrix) Chromebook using the MrChromebox firmware has
# a builtin keyboard with identifier 0001:0001. The Linux kernel matches the
# generic AT keyboard driver with this device.
# Quirks of the way the firmware maps keys with the AT keyboard driver directly (without keyd):
#   - There's only leftshift and leftcontrol (no right versions).
#   - There is leftalt and rightalt. altgr is rightalt.
#   - The ChromeOS Search key (where CapsLock usually is placed) is leftmeta.
#     There is no rightmeta.
#
# NOTE: All of the listed identifiers don't necessary match to the same driver.
# For example, k:0001:0001 is matched to the generic AT keyboard driver, while
# others might be matched to the cros_ec_keyb driver.
[ids]
k:18d1:5061
k:18d1:5044
k:18d1:503c
k:18d1:5057
k:18d1:502b
k:18d1:505b
k:0001:0001
k:18d1:504c
k:18d1:503d
k:18d1:5052
k:18d1:5050
k:0000:0000
k:18d1:5030

## Normalize physical location of modifier keys
[aliases]
# There is no physical meta/Super key on the hardware in the expected location
# (typically between leftcontrol and leftalt, or between leftalt and space).
leftalt = meta

# Now that we've removed the leftalt, we make rightalt behave as alt. By
# default, rightalt behaves as altgr, which is distinct. We are sacrificing
# access to altgr, which is not a key I typically use (mostly used on
# international layouts to type special characters).
rightalt = alt

# The driver will map the ChromeOS Search key, located where Caps Lock is
# typically found, to leftmeta. Now that we've moved meta, we can make that key
# behave as capslock.
leftmeta = capslock

# Redeclaring part of the default config, because we have a custom alias which
# needs to hook into these bindings, so it needs to be processed again.
[main]
meta = layer(meta)
alt = layer(alt)


## Function keys
# The top row of keys behave as the icon printed on them. Most of this is
# handled by the driver, but we list all of them here in order of left to right,
# skipping escape, to document each key.
[main]
back = back
refresh = refresh
# Frame icon - Mapped to F11 which many apps interpret as Fullscreen
zoom = f11
# Overview icon - Looks like a stack of windows, can be used for window focus
scale = cyclewindows
# Camera icon - Using as PrintScreen key, which is apparently the same thing as sysrq
sysrq = sysrq
# Screen brightness
brightnessdown = brightnessdown
brightnessup = brightnessup
# Keyboard backlight - kbdillumtoggle fires XF86KbdLightOnOff
kbdillumtoggle = kbdillumtoggle
# Media
playpause = playpause
micmute = micmute
mute = mute
volumedown = volumedown
volumeup = volumeup
# Lock icon - Using as a key that can easily be mapped to locking the screen and seems close enough semantically
# Not sure if the firmware sends a true ACPI Sleep key
sleep = coffee

# The top row gains a couple additional behaviors when combined with alt
[alt]
# Keyboard backlight
# kbdillumdown fires XF86KbdBrightnessDown
brightnessdown = kbdillumdown
# kbdillumup fires XF86KbdBrightnessUp
brightnessup = kbdillumup


# The top row behaves as traditional function keys (F1-F14) when combined with
# meta (Super)
[meta]
back = f1
refresh = f2
zoom = f3
scale = f4
sysrq = f5
brightnessdown = f6
brightnessup = f7
kbdillumtoggle = f8
playpause = f9
micmute = f10
mute = f11
volumedown = f12
volumeup = f13
sleep = f14

## Full layout - regaining missing keys
[alt]
backspace = delete
left = home
right = end
up = pageup
down = pagedown

# TODO: Test out whether the following mapping is actually necessary. If
# backspace is already mapped to delete (above), then shouldn't this just work?
# [control+alt]
# backspace = C-A-delete

################################################################################
# Once we have a complete and usable keyboard, we apply customizations and
# preferences, which I would want across all physical hardware.
include common
